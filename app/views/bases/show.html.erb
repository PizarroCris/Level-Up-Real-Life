<div class="player-hud">
  <h1><%= @profile.username %>'s Base (Level <%= @profile.level %>)</h1>
  <div class="resources">
    <span>🌲 Wood: <%= @profile.wood %></span>
    <span>⛰️ Stone: <%= @profile.stone %></span>
    <span>🔩 Metal: <%= @profile.metal %></span>
  </div>
</div>

<% if flash[:notice] %>
  <div class="alert alert-success"><%= flash[:notice] %></div>
<% end %>
<% if flash[:alert] %>
  <div class="alert alert-danger"><%= flash[:alert] %></div>
<% end %>

<div class="base-container" data-controller="building-menu">

  <% @plots.each do |plot| %>
    <% building = @buildings_by_plot_id[plot.id] %>
    <div class="plot-area <%= building ? 'building-plot' : 'empty-plot' %>" style="top: <%= plot.top_percent %>%; left: <%= plot.left_percent %>%;">

      <% if building %>
        <div class="building-wrapper"
             data-action="click->building-menu#show"
             data-building-show-url="<%= building_path(building) %>"
             data-building-upgrade-url="<%= upgrade_building_path(building) %>"
             data-building-upgrade-cost="<%= building.upgrade_cost.present? %>">
          <%= image_tag building.image_asset_path, alt: "#{building.building_type.capitalize} Level #{building.level}" %>
          <div class="building-level-badge"><%= building.level %></div>
        </div>

      <% else %>
        <%= link_to new_building_path(plot_id: plot.id) do %>
          <span>+</span>
        <% end %>
      <% end %>

    </div>
  <% end %>

  <div class="building-menu" data-building-menu-target="menu">
    <a href="#" data-building-menu-target="detailsLink" class="btn btn-info btn-sm">Detalhes</a>
    
    <div data-building-menu-target="upgradeFormContainer">
      <%= button_to "Upgrade", "#", method: :patch, class: "btn btn-success btn-sm" %>
    </div>
  </div>

  <%= render 'inventory_popup' %>
  <%= render 'menu_popup' %>
  <%= render 'shop_popup' %>

  <div class="game-hud-buttons p-3">
    <div class="d-flex justify-content-between">
      <%= link_to "Inventory", "#", class: "btn btn-primary rounded-5", data: { action: "click->inventory#showInventory" } %>
      <div class="d-flex gap-2">
        <%= link_to "Menu", "#", class: "btn btn-primary rounded-5", data: { action: "click->inventory#showMenu" } %>
        <%= link_to "Shop", "#", class: "btn btn-primary rounded-5", data: { action: "click->inventory#showShop" } %>
      </div>
    </div>
  </div>

</div>
